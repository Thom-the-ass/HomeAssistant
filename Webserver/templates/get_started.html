<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Get Started</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <a class="navbar-brand mx-3" href="/">Home</a>
    </nav>

    <div class="container text-center mt-5">
        <h1>Welcome to the Get Started Page</h1>
        <p>Here, you can set up your smart home devices and configure settings.</p>
        <a href="/" class="btn btn-primary">Go Back</a>
    </div>

    <div class="container mt-5">
        <h2>Registered Devices</h2>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Device Name</th>
                    <th>Category</th>
                    <th>Location</th>
                    <th>IP Address</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for device in devices %}
                <tr>
                    <td>{{ device.name }}</td>
                    <td>{{ device.category }}</td>
                    <td>{{ device.location }}</td>
                    <td>{{ device.ip_address }}</td>
                    <td>
                        <button class="btn btn-danger" onclick="deleteDevice('{{ device.name }}')">Delete</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </table>
    </div>

    <div class="container mt-5">
        <h2>Add a New Device</h2>
        <form id="device-form">
            <div class="mb-3">
                <label class="form-label">Device Name</label>
                <input type="text" class="form-control" id="device_name" required>
            </div>
            <div class="mb-3">
                <div class="mb-3">
                    <label class="form-label">Category</label>
                    <select class="form-control" id="category" required>
                        <option value="Security">Security</option>
                        <option value="Lights">Lights</option>
                        <option value="Climate">Climate</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Location</label>
                <input type="text" class="form-control" id="location" required>
            </div>
            <!--Trying to add a check box for smart devices, if checked, need to change the text for field below from IP address to Control url-->
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="checkbox">
                <label class="form-check-label" for="checkbox">Default switch checkbox input</label>
              </div>
            <div class="mb-3">
                <label class="form-label" id="controlIP">IP Address</label>
                <input type="text" class="form-control" id="ip_address" required>
            </div>
            <button type="submit" class="btn btn-primary">Save Device</button>
        </form>
        
    </div>
    <!--This is the script change the text of the controlIp, still considering it this data needs to be saveds-->
    <script>
        //Get the container
        const checkbox = document.getElementById('checkbox');
        const statusText = document.getElementById('controlIP');

        //changed based off the status of the button
        checkbox.addEventListener('change', function() {
        if (checkbox.checked) {
        statusText.textContent = 'IP Address';
        } else {
        statusText.textContent = 'Control URL';
        }
    });
    </script>


    <!-- This script is for adding new devices-->
    <script>
        document.getElementById("device-form").addEventListener("submit", async function(event) {
            event.preventDefault();
        
            const device = {
                name: document.getElementById("device_name").value,
                category: document.getElementById("category").value,  // Gets selected category
                location: document.getElementById("location").value,
                ip_address: document.getElementById("ip_address").value
            };
        
            const response = await fetch("/save_device", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(device)
            });
        
            if (response.ok) {
                //fetchDevices(); // Refresh the table
                location.reload();
                document.getElementById("device-form").reset();
            } else {
                alert("Error saving device.");
            }
        });
        </script>
 
        

    <footer class="text-center mt-5 p-4 bg-dark text-light">
        <p>&copy; 2025 Smart Home Project</p>
    </footer>
    <script>
        async function deleteDevice(deviceName) {
            if (!confirm("Are you sure you want to delete this device?")) return;
        
            const response = await fetch("/delete_device", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: deviceName })
            });
        
            if (response.ok) {
                alert("Device deleted successfully!");
                location.reload(); // Refresh the page to update the table
            } else {
                alert("Error deleting device.");
            }
        }
        </script>
</body>
</html>